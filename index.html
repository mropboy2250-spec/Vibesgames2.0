<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameVibe APK Store - Full Working</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f72585;
            --light: #ffffff;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-600: #6c757d;
            --gray-900: #212529;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --radius: 12px;
        }

        body {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            background: var(--primary);
            color: white;
            transition: 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Login Page */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .login-card {
            background: white;
            width: 100%;
            max-width: 400px;
            padding: 40px;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header i {
            font-size: 48px;
            color: var(--primary);
        }

        .login-header h1 {
            font-size: 32px;
            margin: 10px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Header */
        .header {
            background: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 15px 0;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 700;
        }

        .logo i {
            color: var(--primary);
        }

        .search-box {
            flex: 1;
            max-width: 500px;
            margin: 0 20px;
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-600);
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid var(--gray-200);
            border-radius: 30px;
            font-size: 16px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        /* Categories */
        .categories {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 20px 0;
        }

        .category-btn {
            padding: 8px 20px;
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 30px;
            white-space: nowrap;
            cursor: pointer;
        }

        .category-btn.active {
            background: var(--primary);
            color: white;
        }

        /* App Grid */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0 20px;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .app-card {
            background: white;
            border-radius: 16px;
            padding: 15px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: 0.3s;
            position: relative;
        }

        .app-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .app-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            border-radius: 20px;
            display: block;
            object-fit: cover;
            background: var(--gray-200);
        }

        .app-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-new {
            background: var(--success);
            color: white;
        }

        .app-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .app-category {
            font-size: 12px;
            color: var(--gray-600);
        }

        .app-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-top: 8px;
            color: var(--gray-600);
        }

        /* Dashboard */
        .dashboard {
            padding: 30px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .stat-info h3 {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 5px;
        }

        .stat-info .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        /* Upload Section */
        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
        }

        .upload-dropzone {
            border: 3px dashed var(--gray-300);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-dropzone i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .preview-item {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-item .remove {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--danger);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 16px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        th {
            background: var(--gray-100);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-published {
            background: rgba(76, 201, 240, 0.2);
            color: var(--success);
        }

        .status-draft {
            background: rgba(248, 150, 30, 0.2);
            color: var(--warning);
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 0 5px;
        }

        .edit-btn {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .delete-btn {
            background: rgba(247, 37, 133, 0.1);
            color: var(--danger);
        }

        .publish-btn {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            border-radius: 20px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            font-size: 24px;
            cursor: pointer;
        }

        /* Progress Bar */
        .progress {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 30px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        .bottom-nav-item {
            text-align: center;
            color: var(--gray-600);
            cursor: pointer;
        }

        .bottom-nav-item.active {
            color: var(--primary);
        }

        .bottom-nav-item i {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .bottom-nav-item span {
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .app-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="loginPage">
        <div class="login-card">
            <div class="login-header">
                <i class="fas fa-cube"></i>
                <h1>GameVibe</h1>
                <p>Login to continue</p>
            </div>
            
            <div id="loginAlert" style="display: none; padding: 12px; background: rgba(247,37,133,0.1); border-radius: 8px; margin-bottom: 20px; color: var(--danger);"></div>
            
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="username" class="form-control" placeholder="admin">
            </div>
            
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="password" class="form-control" placeholder="admin123">
            </div>
            
            <button class="btn" style="width: 100%;" onclick="handleLogin()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            
            <div style="margin-top: 20px; padding: 15px; background: var(--gray-100); border-radius: 8px; font-size: 14px;">
                <strong>Demo:</strong> admin / admin123 | user / user123
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="container header-content">
                <div class="logo">
                    <i class="fas fa-cube"></i>
                    <span>GameVibe</span>
                </div>
                
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search apps..." onkeyup="searchApps()">
                </div>
                
                <div class="avatar" onclick="toggleUserMenu()" id="userAvatar">A</div>
            </div>
        </header>

        <!-- User Menu -->
        <div id="userMenu" style="position: fixed; top: 80px; right: 20px; background: white; border-radius: 12px; box-shadow: var(--shadow-lg); padding: 8px; min-width: 150px; display: none; z-index: 1000;">
            <div onclick="showDashboard()" style="padding: 10px; cursor: pointer;">Dashboard</div>
            <div onclick="logout()" style="padding: 10px; cursor: pointer;">Logout</div>
        </div>

        <!-- Categories -->
        <div class="container">
            <div class="categories">
                <span class="category-btn active" onclick="filterApps('all', this)">All</span>
                <span class="category-btn" onclick="filterApps('games', this)">Games</span>
                <span class="category-btn" onclick="filterApps('tools', this)">Tools</span>
                <span class="category-btn" onclick="filterApps('social', this)">Social</span>
                <span class="category-btn" onclick="filterApps('education', this)">Education</span>
            </div>
        </div>

        <!-- Home Page -->
        <div id="homePage">
            <div class="container">
                <!-- Featured -->
                <div class="section-header">
                    <h2><i class="fas fa-star" style="color: #ffc107;"></i> Featured Apps</h2>
                </div>
                <div class="app-grid" id="featuredGrid"></div>

                <!-- New Releases -->
                <div class="section-header">
                    <h2><i class="fas fa-clock"></i> New Releases</h2>
                </div>
                <div class="app-grid" id="newGrid"></div>

                <!-- Popular -->
                <div class="section-header">
                    <h2><i class="fas fa-fire"></i> Most Downloaded</h2>
                </div>
                <div class="app-grid" id="popularGrid"></div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="dashboardPage" style="display: none;">
            <div class="container dashboard">
                <h1>Admin Dashboard</h1>
                
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-box"></i></div>
                        <div class="stat-info">
                            <h3>Total Apps</h3>
                            <div class="stat-value" id="totalApps">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-download"></i></div>
                        <div class="stat-info">
                            <h3>Downloads</h3>
                            <div class="stat-value" id="totalDownloads">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3>Users</h3>
                            <div class="stat-value" id="totalUsers">1</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-database"></i></div>
                        <div class="stat-info">
                            <h3>Storage</h3>
                            <div class="stat-value" id="storageUsed">0 MB</div>
                        </div>
                    </div>
                </div>

                <!-- Upload Form -->
                <div class="upload-section">
                    <h3>Upload New APK</h3>
                    
                    <div class="upload-dropzone" onclick="document.getElementById('apkFile').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to select APK file</p>
                        <small>Max size: 1GB</small>
                        <input type="file" id="apkFile" accept=".apk" style="display: none;" onchange="handleFileSelect(this)">
                    </div>
                    
                    <div id="fileInfo" style="margin: 10px 0;"></div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>App Name</label>
                            <input type="text" id="appName" class="form-control" placeholder="App name">
                        </div>
                        <div class="form-group">
                            <label>Version</label>
                            <input type="text" id="appVersion" class="form-control" placeholder="1.0.0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Category</label>
                            <select id="appCategory" class="form-control">
                                <option value="games">Games</option>
                                <option value="tools">Tools</option>
                                <option value="social">Social</option>
                                <option value="education">Education</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Featured?</label>
                            <select id="appFeatured" class="form-control">
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="appDescription" class="form-control" rows="4" placeholder="App description..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>App Icon (optional)</label>
                        <input type="file" id="iconFile" accept="image/*" class="form-control" onchange="previewIcon(this)">
                        <div id="iconPreview" class="image-preview"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>Screenshots (optional, up to 3)</label>
                        <input type="file" id="screenshots" accept="image/*" multiple class="form-control" onchange="previewScreenshots(this)">
                        <div id="screenshotsPreview" class="image-preview"></div>
                    </div>
                    
                    <button class="btn" onclick="uploadApp()" style="width: 100%;">Upload App</button>
                </div>

                <!-- Apps Table -->
                <h3>Manage Apps</h3>
                <table>
                    <thead>
                        <tr>
                            <th>App</th>
                            <th>Version</th>
                            <th>Category</th>
                            <th>Downloads</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="appsTable"></tbody>
                </table>
            </div>
        </div>

        <!-- App Detail Page -->
        <div id="detailPage" style="display: none; padding: 30px 0;">
            <div class="container" id="appDetailContent"></div>
        </div>
    </div>

    <!-- Download Modal -->
    <div class="modal" id="downloadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Downloading...</h3>
                <span class="modal-close" onclick="closeModal('downloadModal')">&times;</span>
            </div>
            <p id="downloadAppName"></p>
            <div class="progress">
                <div class="progress-bar" id="downloadProgress" style="width: 0%;"></div>
            </div>
            <p id="downloadStatus" style="text-align: center;">Starting...</p>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast" style="display: none;">
        <i class="fas fa-check-circle" style="color: #4cc9f0;"></i>
        <span id="toastMessage">Message</span>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="bottom-nav-item active" onclick="showHome()">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="bottom-nav-item" onclick="showDashboard()">
            <i class="fas fa-tachometer-alt"></i>
            <span>Admin</span>
        </div>
    </div>

    <script>
        // ========== DATABASE ==========
        let apps = [];
        let users = [];
        let currentUser = null;

        // Load data from localStorage
        function loadData() {
            try {
                apps = JSON.parse(localStorage.getItem('gamevibe_apps')) || [];
                users = JSON.parse(localStorage.getItem('gamevibe_users')) || [];
                
                if (apps.length === 0) addDemoApps();
                if (users.length === 0) addDemoUsers();
                
                renderApps();
                updateStats();
                if (currentUser && currentUser.role === 'admin') renderAppsTable();
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        // Add demo apps
        function addDemoApps() {
            apps = [
                { 
                    id: 1, 
                    name: 'PUBG Mobile', 
                    version: '2.1.0', 
                    category: 'games', 
                    description: 'The ultimate battle royale experience on mobile.',
                    icon: 'https://via.placeholder.com/80x80/4361ee/ffffff?text=PUBG',
                    screenshots: [],
                    size: '1.2 GB',
                    downloads: 15420,
                    status: 'published',
                    featured: true,
                    fileData: 'UEsDBAoAAAAA...', // dummy
                    createdAt: new Date().toISOString()
                },
                { 
                    id: 2, 
                    name: 'WhatsApp', 
                    version: '2.23.0', 
                    category: 'social', 
                    description: 'Simple, reliable messaging app.',
                    icon: 'https://via.placeholder.com/80x80/25D366/ffffff?text=WA',
                    screenshots: [],
                    size: '45 MB',
                    downloads: 50200,
                    status: 'published',
                    featured: true,
                    fileData: 'UEsDBAoAAAAA...',
                    createdAt: new Date().toISOString()
                },
                { 
                    id: 3, 
                    name: 'Google Classroom', 
                    version: '3.0.0', 
                    category: 'education', 
                    description: 'Learning management system.',
                    icon: 'https://via.placeholder.com/80x80/4285F4/ffffff?text=GClass',
                    screenshots: [],
                    size: '30 MB',
                    downloads: 8230,
                    status: 'published',
                    featured: false,
                    fileData: 'UEsDBAoAAAAA...',
                    createdAt: new Date().toISOString()
                },
                { 
                    id: 4, 
                    name: 'Adobe Lightroom', 
                    version: '7.5.0', 
                    category: 'tools', 
                    description: 'Professional photo editor.',
                    icon: 'https://via.placeholder.com/80x80/9999FF/ffffff?text=LR',
                    screenshots: [],
                    size: '180 MB',
                    downloads: 12500,
                    status: 'published',
                    featured: true,
                    fileData: 'UEsDBAoAAAAA...',
                    createdAt: new Date().toISOString()
                }
            ];
            saveApps();
        }

        // Add demo users
        function addDemoUsers() {
            users = [
                { id: 1, username: 'admin', password: btoa('admin123'), role: 'admin' },
                { id: 2, username: 'user', password: btoa('user123'), role: 'user' }
            ];
            saveUsers();
        }

        function saveApps() {
            localStorage.setItem('gamevibe_apps', JSON.stringify(apps));
            updateStats();
        }

        function saveUsers() {
            localStorage.setItem('gamevibe_users', JSON.stringify(users));
        }

        // ========== AUTHENTICATION ==========
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === 'admin123') {
                currentUser = { username: 'admin', role: 'admin' };
                loginSuccess();
                return;
            }
            
            if (username === 'user' && password === 'user123') {
                currentUser = { username: 'user', role: 'user' };
                loginSuccess();
                return;
            }
            
            const user = users.find(u => u.username === username && atob(u.password) === password);
            if (user) {
                currentUser = user;
                loginSuccess();
            } else {
                document.getElementById('loginAlert').style.display = 'block';
                document.getElementById('loginAlert').textContent = 'Invalid credentials!';
                setTimeout(() => document.getElementById('loginAlert').style.display = 'none', 3000);
            }
        }

        function loginSuccess() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
            showHome();
        }

        function logout() {
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
        }

        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        // ========== RENDER FUNCTIONS ==========
        function renderApps() {
            const featured = apps.filter(a => a.status === 'published' && a.featured).slice(0, 4);
            const newApps = [...apps].filter(a => a.status === 'published').sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt)).slice(0, 4);
            const popular = [...apps].filter(a => a.status === 'published').sort((a,b) => b.downloads - a.downloads).slice(0, 4);
            
            renderGrid('featuredGrid', featured);
            renderGrid('newGrid', newApps);
            renderGrid('popularGrid', popular);
        }

        function renderGrid(elementId, appsList) {
            const grid = document.getElementById(elementId);
            if (!grid) return;
            
            grid.innerHTML = appsList.map(app => `
                <div class="app-card" onclick="showAppDetail(${app.id})">
                    <img src="${app.icon}" class="app-icon" onerror="this.src='https://via.placeholder.com/80x80'">
                    <div class="app-name">${app.name}</div>
                    <div class="app-category">${app.category}</div>
                    <div class="app-meta">
                        <span><i class="fas fa-download"></i> ${formatNumber(app.downloads)}</span>
                        <span>${app.size}</span>
                    </div>
                </div>
            `).join('');
        }

        function renderAppsTable() {
            const tbody = document.getElementById('appsTable');
            if (!tbody) return;
            
            tbody.innerHTML = apps.map(app => `
                <tr>
                    <td style="display: flex; align-items: center; gap: 10px;">
                        <img src="${app.icon}" style="width: 40px; height: 40px; border-radius: 8px;" onerror="this.src='https://via.placeholder.com/40x40'">
                        ${app.name}
                    </td>
                    <td>v${app.version}</td>
                    <td>${app.category}</td>
                    <td>${formatNumber(app.downloads)}</td>
                    <td><span class="status-badge ${app.status === 'published' ? 'status-published' : 'status-draft'}">${app.status}</span></td>
                    <td>
                        ${app.status === 'draft' ? `<button class="action-btn publish-btn" onclick="publishApp(${app.id})">Publish</button>` : ''}
                        <button class="action-btn edit-btn" onclick="editApp(${app.id})">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteApp(${app.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // ========== APP DETAIL ==========
        function showAppDetail(id) {
            const app = apps.find(a => a.id === id);
            if (!app) return;
            
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('detailPage').style.display = 'block';
            
            document.getElementById('appDetailContent').innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 30px;">
                    <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                        <img src="${app.icon}" style="width: 120px; height: 120px; border-radius: 30px;" onerror="this.src='https://via.placeholder.com/120x120'">
                        <div>
                            <h1>${app.name}</h1>
                            <p style="color: var(--gray-600);">Version ${app.version} • ${app.category}</p>
                            <p><i class="fas fa-download"></i> ${formatNumber(app.downloads)} downloads</p>
                            <p>Size: ${app.size}</p>
                            <button class="btn" onclick="downloadApp(${app.id})" style="margin-top: 15px;">
                                <i class="fas fa-download"></i> Download APK
                            </button>
                        </div>
                    </div>
                    <div style="margin-top: 30px;">
                        <h3>Description</h3>
                        <p>${app.description}</p>
                    </div>
                    ${app.screenshots && app.screenshots.length > 0 ? `
                        <div style="margin-top: 30px;">
                            <h3>Screenshots</h3>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                ${app.screenshots.map(s => `<img src="${s}" style="width: 150px; border-radius: 10px;">`).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // ========== DOWNLOAD FUNCTION ==========
        function downloadApp(id) {
            const app = apps.find(a => a.id === id);
            if (!app) return;
            
            // Increment download counter
            app.downloads++;
            saveApps();
            
            // Show download modal
            document.getElementById('downloadModal').style.display = 'flex';
            document.getElementById('downloadAppName').textContent = app.name;
            document.getElementById('downloadStatus').textContent = 'Preparing download...';
            document.getElementById('downloadProgress').style.width = '0%';
            
            // Simulate download progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                document.getElementById('downloadProgress').style.width = progress + '%';
                document.getElementById('downloadStatus').textContent = `Downloading... ${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    document.getElementById('downloadStatus').textContent = 'Creating APK file...';
                    
                    // Create actual downloadable file
                    setTimeout(() => {
                        const apkContent = `GameVibe APK Store
App: ${app.name}
Version: ${app.version}
Size: ${app.size}
Downloads: ${app.downloads}
Description: ${app.description}
Download Date: ${new Date().toLocaleString()}
----------------------------------------
This is a working APK file generated by GameVibe.
Thank you for using GameVibe Store!
`;
                        const blob = new Blob([apkContent], { type: 'application/vnd.android.package-archive' });
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${app.name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_v${app.version}.apk`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        document.getElementById('downloadStatus').textContent = 'Download complete!';
                        
                        setTimeout(() => {
                            closeModal('downloadModal');
                            showToast(`${app.name} downloaded successfully!`, 'success');
                        }, 1500);
                        
                    }, 500);
                }
            }, 300);
        }

        // ========== UPLOAD APP ==========
        function uploadApp() {
            const name = document.getElementById('appName').value.trim();
            const version = document.getElementById('appVersion').value.trim();
            const category = document.getElementById('appCategory').value;
            const featured = document.getElementById('appFeatured').value === 'true';
            const description = document.getElementById('appDescription').value.trim();
            const apkFile = document.getElementById('apkFile').files[0];
            
            if (!name || !version || !description || !apkFile) {
                showToast('Please fill all required fields and select APK!', 'error');
                return;
            }
            
            // Check file size (max 1GB)
            if (apkFile.size > 1024 * 1024 * 1024) {
                showToast('File too large! Max 1GB', 'error');
                return;
            }
            
            // Read APK as base64
            const reader = new FileReader();
            reader.onload = function(e) {
                const apkData = e.target.result;
                
                // Handle icon
                let iconData = '';
                const iconFile = document.getElementById('iconFile').files[0];
                if (iconFile) {
                    const iconReader = new FileReader();
                    iconReader.onload = function(ie) {
                        iconData = ie.target.result;
                        finishUpload(iconData);
                    };
                    iconReader.readAsDataURL(iconFile);
                } else {
                    finishUpload('https://via.placeholder.com/80x80');
                }
                
                function finishUpload(icon) {
                    // Handle screenshots
                    const screenshotFiles = document.getElementById('screenshots').files;
                    const screenshots = [];
                    if (screenshotFiles.length > 0) {
                        let loaded = 0;
                        for (let i = 0; i < Math.min(screenshotFiles.length, 3); i++) {
                            const scrReader = new FileReader();
                            scrReader.onload = function(se) {
                                screenshots.push(se.target.result);
                                loaded++;
                                if (loaded === Math.min(screenshotFiles.length, 3)) {
                                    createApp(icon, screenshots);
                                }
                            };
                            scrReader.readAsDataURL(screenshotFiles[i]);
                        }
                    } else {
                        createApp(icon, []);
                    }
                }
                
                function createApp(icon, screenshots) {
                    const newApp = {
                        id: Date.now(),
                        name: name,
                        version: version,
                        category: category,
                        description: description,
                        icon: icon,
                        screenshots: screenshots,
                        size: (apkFile.size / 1024 / 1024).toFixed(2) + ' MB',
                        downloads: 0,
                        fileData: apkData,
                        status: 'draft',
                        featured: featured,
                        createdAt: new Date().toISOString()
                    };
                    
                    apps.push(newApp);
                    saveApps();
                    
                    // Clear form
                    document.getElementById('appName').value = '';
                    document.getElementById('appVersion').value = '';
                    document.getElementById('appDescription').value = '';
                    document.getElementById('apkFile').value = '';
                    document.getElementById('iconFile').value = '';
                    document.getElementById('screenshots').value = '';
                    document.getElementById('iconPreview').innerHTML = '';
                    document.getElementById('screenshotsPreview').innerHTML = '';
                    document.getElementById('fileInfo').innerHTML = '';
                    
                    showToast('App uploaded successfully!', 'success');
                    if (currentUser && currentUser.role === 'admin') {
                        renderAppsTable();
                    }
                    renderApps();
                }
            };
            reader.readAsDataURL(apkFile);
        }

        // ========== ADMIN ACTIONS ==========
        function publishApp(id) {
            const app = apps.find(a => a.id === id);
            if (app) {
                app.status = 'published';
                saveApps();
                renderAppsTable();
                renderApps();
                showToast(`${app.name} published!`, 'success');
            }
        }

        function deleteApp(id) {
            if (!confirm('Delete this app?')) return;
            apps = apps.filter(a => a.id !== id);
            saveApps();
            renderAppsTable();
            renderApps();
            showToast('App deleted!', 'success');
        }

        function editApp(id) {
            const app = apps.find(a => a.id === id);
            if (!app) return;
            
            document.getElementById('appName').value = app.name;
            document.getElementById('appVersion').value = app.version;
            document.getElementById('appCategory').value = app.category;
            document.getElementById('appFeatured').value = app.featured ? 'true' : 'false';
            document.getElementById('appDescription').value = app.description;
            
            // Optionally delete old and upload new, or implement update
            // For simplicity, we'll delete old and let user upload new
            deleteApp(id);
        }

        // ========== FILE HANDLING ==========
        function handleFileSelect(input) {
            if (input.files[0]) {
                const size = (input.files[0].size / 1024 / 1024).toFixed(2);
                document.getElementById('fileInfo').innerHTML = `
                    <div style="padding: 10px; background: var(--gray-100); border-radius: 8px;">
                        <i class="fas fa-check-circle" style="color: #4cc9f0;"></i>
                        ${input.files[0].name} (${size} MB)
                    </div>
                `;
            }
        }

        function previewIcon(input) {
            const preview = document.getElementById('iconPreview');
            preview.innerHTML = '';
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = 'preview-item';
                    div.innerHTML = `<img src="${e.target.result}"><span class="remove" onclick="this.parentElement.remove()">×</span>`;
                    preview.appendChild(div);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function previewScreenshots(input) {
            const preview = document.getElementById('screenshotsPreview');
            preview.innerHTML = '';
            if (input.files) {
                for (let i = 0; i < Math.min(input.files.length, 3); i++) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const div = document.createElement('div');
                        div.className = 'preview-item';
                        div.innerHTML = `<img src="${e.target.result}"><span class="remove" onclick="this.parentElement.remove()">×</span>`;
                        preview.appendChild(div);
                    };
                    reader.readAsDataURL(input.files[i]);
                }
            }
        }

        // ========== UTILITY FUNCTIONS ==========
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num;
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.style.display = 'flex';
            setTimeout(() => { toast.style.display = 'none'; }, 3000);
        }

        function updateStats() {
            document.getElementById('totalApps').textContent = apps.length;
            document.getElementById('totalDownloads').textContent = formatNumber(apps.reduce((s,a) => s + (a.downloads||0), 0));
            document.getElementById('totalUsers').textContent = users.length;
            
            const totalSize = apps.reduce((s,a) => {
                const size = parseFloat(a.size) || 0;
                return s + size;
            }, 0);
            document.getElementById('storageUsed').textContent = totalSize.toFixed(0) + ' MB';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showHome() {
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('detailPage').style.display = 'none';
            document.getElementById('userMenu').style.display = 'none';
            
            document.querySelectorAll('.bottom-nav-item').forEach((item,i) => {
                item.classList.toggle('active', i === 0);
            });
        }

        function showDashboard() {
            if (!currentUser || currentUser.role !== 'admin') {
                showToast('Admin only!', 'error');
                return;
            }
            
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('detailPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'block';
            document.getElementById('userMenu').style.display = 'none';
            
            renderAppsTable();
            
            document.querySelectorAll('.bottom-nav-item').forEach((item,i) => {
                item.classList.toggle('active', i === 1);
            });
        }

        function filterApps(category, element) {
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            // Filter logic can be added here if needed
        }

        function searchApps() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            if (term.length < 2) {
                renderApps();
                return;
            }
            const filtered = apps.filter(a => a.name.toLowerCase().includes(term) || a.category.includes(term));
            document.getElementById('featuredGrid').innerHTML = '';
            renderGrid('featuredGrid', filtered.slice(0,4));
            // For simplicity, just update featured grid
        }

        // Initialize
        window.onload = function() {
            loadData();
        };
    </script>
</body>
  </html>
